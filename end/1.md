# Sinatra简单Web应用

B1任务中，大家可以开始接触HTTP相关的知识，并开始写一个简单的服务器了。这次的项目比较综合，会涉及到各方面的知识，希望各位多多努力。

## 任务要求

1. 安装Sinatra插件，并了解其用法

2. 了解HTTP协议，知道其流程以及get, post,patch, put, delete等动词，尤其是前两个

3. 了解一些基础的html标签，会使用文本编辑器书写html

4. 编写一个简单的留言板应用，应用的要求如下：

首先，规定一下留言的数据结构，一个留言需要包含一下内容：

|字段名    |类型  |描述|
|:--------:|:----:|----|
|id        |Fixnum|留言的ID，由系统发放，应当是一个自增的值，并且不可重复|
|message   |String|留言的内容|
|author    |String|留言的作者|
|created_at|Date  |留言创建的日期|

你需要专门建立一个类来管理用户的留言数据，其操作如下

添加留言 返回留言ID

删除留言  传入留言的ID（有可能是一个int，也有可能是一个包含多个id的数组，都需要处理）。如果成功返回删除成功的消息条数，如果失败返回一个错误信息

查询留言  首先可以查询所有的记录也可以按照id或者author来查询一部分的记录。按照id查询直接返回一个记录，按author查询返回一个记录数组。输出的内容可以选择按照id或者created_at排序（但不允许更改原数据），

接下来，你需要根据URL的路径来为用户提供不同的服务：

get /
显示所有的留言，留言按照表格形式输出，且需要按照时间倒序输出。在每条留言后面都会有一个删除的按钮，点击后会删除这条留言。

请注意，这个页面应该有一个表单，这个表单里面包含两个输入框和一个提交框，可以用id或者author来筛选留言。提交后，会进入一个类似于 /?id=1 或者 /?author=some 的页面。你的程序应该要可以根据这些参数来筛选出对应的信息条目

post /add
通过一个form表单传入message和author信息，服务器接收到请求之后先验证数据，保证内容不小于10个字，作者不为空，如果通过就插入数据并跳转回首页，如果失败就显示一个错误信息，错误信息上有一个通往首页的链接

get /delete/:id
这里本来应当使用delete动词，不过这样会稍微有点麻烦，所以使用了这个路由。
当服务器接收到这个请求的时候，尝试删除对应id的留言，然后向用户显示操作结果，另外有一个按钮可以返回首页

这三个页面需要的模板可以放在/views/下面

## 检查点

1. get / 时，可以看到留言列表和筛选表单，留言列表按照倒序排序，且每条留言后有一个删除按钮
2. 通过输入筛选条件，可以正确筛选出所需的条目
3. 点击删除按钮时，可以正确删除
4. 当用户提交无效的信息时，会提示用户出错信息。这里需要对所有可能的用户提交内容做验证。
5. 建立了一个类来管理有关留言内容的操作，且结构满足规范
6. 留言类的每一个方法都能考虑到各种的输入情况，能正确的返回数据或错误信息


## 加分项

1. 实现留言编辑功能
2. 以最大效率提高留言类的效率，减少排序、id生成所占用的系统资源
3. 页面简洁完整
4. 在发生错误时可以返回相应地http 状态码
5. 其他你自己能想到的特色功能或者亮点
6. 考虑各种用户可能干的“坏事”，比如在删除留言的URL里直接填入一个不存在的id，程序应当能做出合理的反馈

## 任务期限

本次任务要求在7月25日20点前提交任务。

## 资源和提示

### RESTful路由设计

路由设计要遵循RESTful风格，其实任务的详细要求就是基本符合这个规范的。

严格来说，删除应该用DELETE动词，二次编辑后提交应该用PATCH或PUT动词，这里暂不要求，可以全部用GET和POST来做。

http://www.ruanyifeng.com/blog/2011/09/restful.html

### http协议介绍

http://www.runoob.com/http/http-tutorial.html

### sinatra文档

这个文档非常简单易懂，看完基本就能写个简单的服务器了(这句话可不是我说的，还是要多看几遍文档)
http://www.sinatrarb.com/intro-zh.html

### 渲染模板的选择

Sinatra文档里提供了很多种模板，Haml、Markdown、ERb什么的。
暂时不用考虑别的，就使用ERb(Embedded Ruby)模板就可以，使用方式类似JSP，但尽量不要在里面写太多逻辑，主要是用来展现数据。

### Ruby编程风格

https://github.com/JuanitoFatas/ruby-style-guide/blob/master/README-zhCN.md
